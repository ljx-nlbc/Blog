<!DOCTYPE html>
{% extends 'blog/base.html' %}
{% block content %}
<html>
<head>
    <title>{{ article.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!--æ–‡ç« å…ƒä¿¡æ¯-->
    <div class="article-meta text-muted mb-3">
        <h1>{{ article.title }}</h1>
        <span>ä½œè€…:<strong>{{article.author.username}}</strong></span>|
        <span>åˆ†ç±»:{{article.category.name}}</span>
        <span>å‘å¸ƒæ—¶é—´: {{ article.created | date:"Y-m-d H:i"}}</span>
        <span>æ›´æ–°æ—¶é—´: {{ article.updated | date:"Y-m-d H:i"}}</span>
        <span>æ¸¸è§ˆé‡:{{article.views}}</span>
    </div>

    <!--æ“ä½œæŒ‰é’®(ä»…ä½œè€…å¯è§)-->
    {% if user == article.author %}
    <div class="btn-group mb-3">
        <a href="{% url 'blog:article_update' article.pk %}" class="btn btn-sm btn-outline-primary">æ›´æ–°æ–‡ç« </a>
        <form method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit" name="delete_article"
                        class="btn btn-outline-danger" 
                        onclick="return confirm('âš ï¸ ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')">
                    ğŸ—‘ï¸ åˆ é™¤æ–‡ç« 
                </button>
            </form>
    </div>
    {% endif %}
    
    <!--æ–‡ç« å†…å®¹-->
    <section class="article-content mb-5">
        {% if article.excerpt %}
        <div class="alert alert-info">
            <strong>æ‘˜è¦:</strong>{{article.excerpt}}
        </div>
        {%endif%}
        <div class="content-body">
            {{ article.content|linebreaks }}
        </div>
    </section>
    <!--æ ‡ç­¾åŒºåŸŸ-->
    {% if article.tags.all %}
        <section class="tags mb-4">
            <h5>æ ‡ç­¾:</h5>
            {% for tag in article.tags.all %}
                <span class="badge bg-secondary">{{ tag.name }}</span>
            {% endfor %}
        </section>
    {% endif %}
    <!--å¯¼èˆªæŒ‰é’®-->
    <div class="mt-4">
        <a href="{% url 'blog:article_list' %}" class="btn btn-secondary">è¿”å›åˆ—è¡¨</a> 
    </div>
    <!--è¯„è®ºåŒº-->
    <section class="comments">  
        <!-- è¯„è®ºè¡¨å•ï¼ˆä»…ç™»å½•ç”¨æˆ·å¯è§ï¼‰ -->
        {% if user.is_authenticated %}
        <div class="comment-form mb-5">
            <form method="post">
                {% csrf_token %}
                {{comment_form.as_div}}
                <button type="submit" name="submit_comment" class="btn btn-primary">æäº¤è¯„è®º</button>
            </form>
        </div>
        {% else %}
        <div class="alert alert-info">
            è¯·<a href="{% url 'accounts:login' %}">ç™»å½•</a>åå‘è¡¨è¯„è®ºã€‚
        </div>
        {% endif %}
        <!-- è¯„è®ºåˆ—è¡¨ -->
        <div class="comments-list">         
            {% for comment in article.comment_set.all %}
            <div class="card mb-1">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <h6 class="card-title">{{ comment.usr }}</h6>
                        <small class="text-muted">{{ comment.created|date:"Y-m-d H:i" }}</small>
                        {% if user == comment.usr %}
                        <form method="post">
                            {% csrf_token %}     
                            <input type="hidden" name="comment_id" value="{{comment.id}}">                     
                            <button type="submit" name="delete_comment" class="btn btn-primary">ğŸ—‘ï¸</button>
                        </form>           
                        {% endif %}
                    </div>
                    <p class="card-text">{{ comment.content|linebreaks }}</p>
                </div>
            </div>
            {% empty %}
            <div class="alert alert-secondary">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï¼</div>
            {% endfor %}
        </div>
        
    </section>
</body>
</html>
{% endblock %}